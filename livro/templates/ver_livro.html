{% extends 'base.html' %}
{% load filtros %}

{% block 'content' %}

<div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Deseja mesmo excluir o livro?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <a href="{% url 'excluir-livro' id_livro %}" class="btn btn-danger btn-lg">Excluir</a>
            </div>
        </div>
    </div>
</div>

<div class="container">

    <br>
    <form action="{% url 'alterar-livro' %}" method="POST">
        {% csrf_token %}
        <input type="hidden" value="{{livro.id}}" name="livro_id">

        <p>
            <label>Nome:</label>
            <input class="form-control" type="text" value="{{livro.nome}}" name="nome_livro">
        </p>
        <p>
            <label>Autor:</label>
            <input style="width: 40%;" class="form-control" type="text" value="{{livro.autor}}" name="autor">
        </p>
        <p>
            <label>Co-autor:</label>
            <input style="width: 40%;" class="form-control" type="text" value="{{livro.co_autor}}" name="co_autor">
        </p>

        <p>
            <label>Categoria:</label>
            <select style="width: 40%;" class="form-control" name="categoria_id">
                {% for i in categoria_livro %}
                {% if livro.categoria == i %}
                <option value="{{i.id}}" selected>{{i}}</option>
                {% else %}
                <option value="{{i.id}}">{{i}}</option>
                {% endif %}
                {% endfor %}
            </select>
        </p>
        <p>
            <label>Data de cadastro:</label>
        <p>{{livro.data_cadastro}}</p>
        </p>

        <label>Emprestado </label>
        {% if livro.emprestado %}
        <svg style="color: green; display: inline;" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
            fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
            <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
        </svg>
        {% else %}
        <svg style="color: red; display: inline;" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
            fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
            <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z" />
        </svg>
        {% endif %}

        <br>
        <br>

        <input type="submit" class="btn btn-success btn-lg" value="Salvar">

    </form>
    <br>
    <button type="button" class="btn btn-danger btn-lg" data-toggle="modal" data-target="#exampleModal2">
        Excluir
    </button>
    <hr>

    <h1>Histórico de empréstimo</h1>

    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Nome</th>
                <th scope="col">Data Empréstimo</th>
                <th scope="col">Data Devolução</th>
                <th scope="col">Tempo de duração</th>
                <th scope="col">Avaliação</th>
            </tr>
        </thead>
        <tbody>
            {% for i in emprestimos %}
            <tr>
                {% if i.nome_emprestado_anonimo == None %}
                <th scope="row">{{i.nome_emprestado}}</th>
                {% else %}
                <th scope="row">{{i.nome_emprestado_anonimo}}</th>
                {% endif %}
                <td>{{i.data_emprestimo}}</td>
                {% if i.data_devolucao == None %}
                <td></td>
                {% else %}
                <td>{{i.data_devolucao}}</td>
                {% endif %}
                <td>{{i.data_devolucao|mostra_duracao:i.data_emprestimo}}</td>
                <td>
                    {% if i.avaliacao == None %}
                    <button onclick="avaliacao({{i.id}})" class="btn btn-info" data-toggle="modal"
                        data-target="#exampleModal1">Avaliar</button>
                    {% else %}
                    {{i.avaliacao}}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Avaliar empréstimo</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="{% url 'processa-avaliacao' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" id="id_livro" name="id_livro" value="{{id_livro}}">
                    <input type="hidden" id="id_emprestimo" name="id_emprestimo">
                    <select class="form-control" name="opcoes" id="opcoes">
                        <option value="P">Péssimo</option>
                        <option value="R">Ruim</option>
                        <option value="B">Bom</option>
                        <option value="O">Ótimo</option>
                    </select>
                    <br>
                    <input type="submit" class="btn btn-info" value="Avaliar">
                </form>
            </div>
        </div>
    </div>
</div>

<script>

    function avaliacao(id_emprestimo) {
        input_emprestimo = document.getElementById('id_emprestimo')
        input_emprestimo.value = id_emprestimo
    }

</script>

{% endblock %}